# Installation
```
pip install -r requirements.txt
```

# To Execute, run:
```
chainlit run chatbot.py --port 8001
```

# Information
1. LLM used - LLama2 hosted on Baseten


# Code Description
```
This code appears to be a Python script for creating a chatbot or agent that can answer questions related to the stock market using an Llama2 language model (LLM) and external tools. Let's break down the code and explain what is happening in as much detail as possible:

1. Import Statements:
   - The script starts by importing various modules and libraries, including:
     - `langchain.agents`: Modules related to agents and tool execution.
     - `langchain.prompts`: Modules for defining prompts.
     - `langchain.utilities.alpha_vantage`: A wrapper for the Alpha Vantage API.
     - `langchain.llms`: Modules related to language models (LLMs).
     - `langchain`: The main LangChain library.
     - `typing`: The typing module for type hints.
     - `re`: The regular expressions module.
     - `os`: The operating system module.
     - `chainlit`: A library for defining chain of responsibility patterns.
   
2. Environment Variables:
   - The script sets environment variables for API keys related to Alpha Vantage and Llama2. These keys are used to authenticate with external services.

3. Prompt Template:
   - A template for questions and responses is defined as a multi-line string. This template includes placeholders for questions, actions, action inputs, and final answers.

4. `CustomPromptTemplate` Class:
   - A custom class is defined, which inherits from `StringPromptTemplate`. This class is responsible for formatting the template and populating it with dynamic content.
   - It overrides the `format` method to create a formatted prompt using the provided data. This includes information about available tools and previous intermediate steps in the conversation.

5. `CustomOutputParser` Class:
   - Another custom class is defined, which inherits from `AgentOutputParser`. This class is responsible for parsing the output generated by the language model.
   - It has a `parse` method that extracts information from the output, including agent actions and action inputs.

6. `@cl.on_chat_start` Decorator:
   - A decorator function is defined to create the agent when the chat session starts.
   - Inside this function, the following steps are performed:
     - An output parser is instantiated using the `CustomOutputParser` class.
     - An LLM (Language Model) instance is created using the `Baseten` class with a specific model identifier.
     - An instance of `AlphaVantageAPIWrapper` is created to access the Alpha Vantage API.
     - A list of tools is defined. In this case, there is a single tool named "Alpha Vantage" with a description.
     - A custom prompt template is created using the `CustomPromptTemplate` class.
     - An instance of `LLMChain` is created, combining the LLM, prompt template, and tools.
     - The tool names are extracted from the list of tools.
     - An instance of `LLMSingleActionAgent` is created, using the LLM chain, an output parser, and other configurations.
     - Finally, an `AgentExecutor` is created from the agent and tools, and it is stored in the user session.

7. `@cl.on_message` Decorator:
   - This decorator function handles incoming messages in the chat.
   - Inside this function, the following steps are performed:
     - The agent executor is retrieved from the user session.
     - The agent is run with the incoming message as input.
     - The response from the agent is generated.
     - The response is sent back to the user.

In summary, this code sets up an agent that uses an Llama2 language model and external tools (in this case, the Alpha Vantage API) to answer questions about the stock market. It defines custom classes for formatting prompts and parsing responses, and it handles user interactions in a chat session. The agent can choose from a list of available tools to perform actions and generate final answers in a specific format.
```